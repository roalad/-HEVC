<div class="col-md-12 page">
  <article class="page-content">
    <div class="well well-sm">
      <p>
        Лог файл або звіт по encode[note][color=#AAE407]Вітаю![/color]  
        Минулого разу по накидав багато чого, будемо тепер в цьому розбиратися більш глибше, це важлива тема, як і попередні.  
        Минулого разу ми отримали три ріпа, на даний момент нас цікавить самий перший:  
        [code]L_new_standart.mkv - стандартний ріп[/code]

        Зайдемо в місце, де він знаходяться, там же має бути папка від головного відео (L.mkv) з назвою - L_temp. Заходимо в неї, нам потрібний файл з назвою:  
        [code]L_new_standart_staxrip.log[/code]

        Відкриваємо і знаходимо такий текст:
        [code]
x265 [INFO]: frame I:     68, Avg QP:19.06  kb/s: 18842.68
x265 [INFO]: frame P:   1231, Avg QP:20.74  kb/s: 7263.29
x265 [INFO]: frame B:   3557, Avg QP:25.34  kb/s: 1404.93
x265 [INFO]: Weighted P-Frames: Y:1.7% UV:0.9%
encoded 4856 frames in 1090.36s (4.45 fps), 3134.22 kb/s, Avg QP:24.09
        [/code]
      </p>

      <p>
        [b][color=#3399ff]Що це означає?[/color][/b]  
        Розділимо це на три блоки:
      </p>

      <p>
        [note][b]1й блок[/b]
        [code]
x265 [INFO]: frame I:     68, Avg QP:19.06  kb/s: 18842.68
x265 [INFO]: frame P:   1231, Avg QP:20.74  kb/s: 7263.29
x265 [INFO]: frame B:   3557, Avg QP:25.34  kb/s: 1404.93
        [/code]

        [b]Що означають frame I, P та B?[/b]  
        • frame I - це ключові кадри, на які спирається наш кодек, [s]вони кодуються без змін[/s]. Поправив дякуючи @mr_duke та @Blackflexxy  
        • frame Р - це кадри, що кодуються, спираючись на попередній кадр, яким може бути frame I або інший frame Р кадр. Це означає, що frame Р зберігає лише різницю між поточним і попереднім кадром.  
        • frame B - це кадри, що кодуються, спираючись як на попередні, так і на наступні кадри. Дякуючи frame B, відео зазнає найкращого стиснення, бо спирається на інформацію з обох напрямків.

        [b]Деталі для frame B:[/b]  
        frame B:3557 - кількість кадрів frame B  
        Avg QP:25.34 - середнє значення квантованості для frame B  
        kb/s: 1404.93 - середнє значення бітрейту для frame B[/note]
      </p>

      <p>
        [note][b]Що таке квантованість QP?[/b]  
        Квантованість QP (Quantization Parameter) - це показник, що визначає рівень стиснення відео на кожному окремому кадрі, тобто кількість деталей, яка буде збережена або втрачена під час кодування. QP впливає на баланс між якістю відео та його розміром:  
        • Чим нижче значення - тим нижчий рівень стиснення, більший файл, краща якість.  
        • Чим більше значення - тим більший рівень стиснення (менше деталізації), менший файл, гірша якість.[/note]
      </p>

      <p>
        [note][b]2й блок[/b]
        [code]
x265 [INFO]: Weighted P-Frames: Y:1.7% UV:0.9%
        [/code]

        [b]Що означають Weighted P-Frames і Weighted B-Frames?[/b]  
        Weighted Prediction for P-Frames перекладається як зважений прогноз для P-фреймів. У нашому випадку Y:1.7% UV:0.9% показує, який відсоток кадрів використовує це прогнозування.  
        Нічого не нагадує Y:1.7% UV:0.9%?  
        Так, YUV вже згадувалося у темі кропання відео. Хто забув - варто ознайомитися ще раз.  
        • Y - це канал, що відповідає за яскравість зображення і містить основну інформацію про деталі.  
        • UV - це канали, що відповідають за колір зображення.

        [b]Детальніше про хромінанс:[/b] [url]https://en.wikipedia.org/wiki/Chrominance[/url]  

        Зверніть увагу, що в лозі немає Weighted B-Frames. Чому його немає? Відповідь проста - ми ще його не застосовували.[/note]
      </p>

      <p>
        [note][b]3й блок[/b]
        [code]
encoded 4856 frames in 1090.36s (4.45 fps), 3134.22 kb/s, Avg QP:24.09
        [/code]

        encoded 4856 frames in 1090.36s — це скільки часу зайняло наше кодування (приблизно 18 хв). Точніша інформація є в тому ж лог файлі:
        [code]
Start: 17:31:48
End:   17:50:00
Duration: 00:18:11
        [/code]

        • 4.45 fps - це швидкість кадрів на секунду під час кодування.  
        • 3134.22 kb/s - це середнє значення бітрейту нашого ріпа.  
        • Avg QP:24.09 - це середнє значення стиснення для всього відео.[/note]
      </p>

      <p>
        [b][color=#3399ff]Підсумок:[/color][/b]  
        Значеннями frame I, frame P, frame B ми будемо управляти за допомогою параметрів у кодеку HEVC. Основна увага зосереджена на frame B і підведенні його квантованості до значення близько 21.

        Дану тему є ще чим доповнити, і ми обов'язково зробимо це в майбутньому, коли навчимося кодувати відео, з більш менш нормальними/логічними параметрами.

        [color=#AAE407]Вітаю! Ми ознайомилися з лог файлом.[/color]
      </p>

      <p>
        [/note]
      </p>

      <p>
        [note]Під топіком виникла дискусія щодо даного запису:

        [quote=@roalad][i]frame I - це ключові кадри, на які спирається наш кодек, вони кодуються без змін.[/i][/quote]
        Ознайомитися можна тут — [url]https://utp.to/forums/topics/454/posts/8760[/url]

        Розібрався в цьому питанні дякуючи даній статті - [url]https://jdhao.github.io/2021/12/25/ffmpeg-extract-key-frame-video/[/url]

        [b][color=#3399ff]Що було зроблено:[/color][/b]
        • Зроблено ріп з дуже малим бітрейтом, який розмиває картинку.
        • Виділено ключові I кадри з ріпа.
        • Зроблено світлини та залито для перегляду.

        [b][color=#3399ff]Лог або encode ріпа:[/color][/b]
        [code]x265 [INFO]: frame I:   39, Avg QP:29.29  kb/s: 6274.41
x265 [INFO]: frame P:  133, Avg QP:32.51  kb/s: 1343.85
x265 [INFO]: frame B:  334, Avg QP:36.24  kb/s: 327.14
x265 [INFO]: Weighted P-Frames: Y:1.5% UV:0.8%
encoded 506 frames in 33.72s (15.01 fps), 1052.77 kb/s, Avg QP:34.73
        [/code]

        [b][color=#3399ff]Світлина виконаного скрипта:[/color][/b]
        На світлині видно кількість frame I, які співпадають з логом.
        [spoiler][img]https://img.utp.pm/2024/11/07/045.png[/img][/spoiler]

        [b][color=#3399ff]Саме порівняння: [/color][/b][url]https://imgsli.com/MzE2NTY4[/url]
        в ньому створив і використав ріп з параметром --lossless, файл получився "жирний", м'яко кажучи. (11Мб проти 513Мб), це при тому що відео на 21 секунду.

        [b][color=#3399ff]Які висновки можна зробити?[/color][/b]

        Ключові кадри, на які спирається кодек при кодуванні, зазнають змін після запуску кодування, а в самому encode вказується, яка кількість кадрів була використана для самого кодування.

        [color=#FF0000]Подяка[/color] @mr_duke та @Blackflexxy, що вказали на це, - тепер я і ви розібрались з питанням як проходить процес кодування більш детально.

        Також поправив топік.[/note]
      </p>
    </div>
  </article>
</div>
